# **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è OpenStack**, –≥–¥–µ:

* **Terraform** —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –≤ –æ–±–ª–∞–∫–µ OpenStack;
* **Ansible** –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ω–µ–π –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Nginx.

---

**–ü–∞–π–ø–ª–∞–π–Ω** (pipeline) ‚Äî —ç—Ç–æ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ (—ç—Ç–∞–ø–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º**, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å –∫–æ–Ω–µ—á–Ω–æ–π —Ü–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

* **—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É**,
* **–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—ã**,
* **–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**,
* **–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∫–æ–¥**.

---

### üîß –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤ DevOps:

1. **Terraform** —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É.
2. **Ansible** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –Ω–∞ –Ω–µ–π –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞–≤–∏—Ç Nginx).
3. **CI/CD-—Å–∏—Å—Ç–µ–º–∞ (GitLab CI, Jenkins)** –∑–∞–ø—É—Å–∫–∞–µ—Ç —ç—Ç–æ –≤—Å—ë –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞.

---

**–ò—Ç–æ–≥:** –ø–∞–π–ø–ª–∞–π–Ω = –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —à–∞–≥–æ–≤ –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞.

–•–æ—á–µ—à—å –ø—Ä–∏–º–µ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤ –≤–∏–¥–µ —Å—Ö–µ–º—ã –∏–ª–∏ –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitLab CI)?


### –ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏:

* –£ –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ OpenStack (auth URL, –ø—Ä–æ–µ–∫—Ç, –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å).
* –ï—Å—Ç—å SSH-–∫–ª—é—á, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤ OpenStack (–Ω–∞–ø—Ä–∏–º–µ—Ä, `my-key`).
* –í OpenStack –µ—Å—Ç—å –æ–±—Ä–∞–∑ Ubuntu (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Ubuntu-22.04`).

---

### –®–∞–≥ 1: Terraform ‚Äî —Å–æ–∑–¥–∞—ë—Ç VM

```hcl
# main.tf
provider "openstack" {
  auth_url    = "https://openstack.example.ru:5000/v3"
  region      = "RegionOne"
  domain_name = "Default"
  tenant_name = "my-project"
  user_name   = "your_user"
  password    = "your_password"
}

resource "openstack_compute_instance_v2" "web" {
  name            = "web-vm"
  image_name      = "Ubuntu-22.04"
  flavor_name     = "m1.small"
  key_pair        = "my-key"
  security_groups = ["default"]

  network {
    name = "private"
  }

  provisioner "local-exec" {
    command = "echo ${self.access_ip_v4} > inventory.txt"
  }
}
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:

* `image_name`, `flavor_name`, `network.name` –∏ —Ç.–¥. –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≤–∞—à–µ–º OpenStack.
* –°–æ–∑–¥–∞–Ω–Ω—ã–π IP –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `inventory.txt`.

---

### –®–∞–≥ 2: Ansible ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç VM

–°–æ–∑–¥–∞—ë–º Ansible-—Ñ–∞–π–ª—ã:

### `inventory.ini` (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏–∑ `inventory.txt`):

```
[web]
<ip-–∏–∑-terraform> ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

### `nginx.yml`:

```yaml
- name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
  hosts: web
  become: true
  tasks:
    - name: –û–±–Ω–æ–≤–∏—Ç—å apt
      apt:
        update_cache: yes

    - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å nginx
      apt:
        name: nginx
        state: present
```

---

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

```bash
terraform init
terraform apply
```

–ó–∞—Ç–µ–º (–µ—Å–ª–∏ IP –≤ `inventory.txt`):

```bash
ansible-playbook -i inventory.txt nginx.yml
```

*–∏–ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ IP –≤ `inventory.ini` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:*

```bash
ansible-playbook -i inventory.ini nginx.yml
```

---

### –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ Ansible –ø—Ä—è–º–æ –∏–∑ Terraform:

```hcl
provisioner "local-exec" {
  command = "ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -i '${self.access_ip_v4},' -u ubuntu --private-key ~/.ssh/id_rsa nginx.yml"
}
```

---
